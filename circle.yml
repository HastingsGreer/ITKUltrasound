machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull kitwaremedical/itkultrasound-base
    - docker pull kitwaremedical/itkultrasound-test

test:
  override:
    - mkdir ~/ITKUltrasound-build
    - docker run -v ~/ITKUltrasound:/usr/src/ITKUltrasound -v ~/ITKUltrasound-build:/usr/src/ITKUltrasound-build kitwaremedical/itkultrasound-test /usr/src/ITKUltrasound/test/Docker/Test/test.sh
    - cp -r ~/ITKUltrasound-build/Testing/Temporary/* $CIRCLE_ARTIFACTS/
    - curl -L https://rawgit.com/InsightSoftwareConsortium/ITKPythonPackage/master/scripts/dockcross-manylinux-download-cache-and-build-module-wheels.sh -O
    - chmod u+x dockcross-manylinux-download-cache-and-build-module-wheels.sh
    - ./dockcross-manylinux-download-cache-and-build-module-wheels.sh
    - cp -r dist $CIRCLE_ARTIFACTS
